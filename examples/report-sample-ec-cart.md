# 分析レポート: ECサイト カート機能

**分析日時**: 2026-01-07 10:00:00  
**ドキュメント**: examples/input-sample-ec-cart.md  
**ドメイン**: ecommerce

---

## エグゼクティブサマリー

入力された要件文書を分析した結果、**8つの未定義要素**が検出されました。
うち**3つは高リスク**で、放置すると以下の問題が発生する可能性があります：

- 在庫の同時実行制御不備による在庫マイナス
- セキュリティ脆弱性（価格改ざん、CSRF攻撃）
- 決済と在庫のデータ不整合

**推奨アクション**: 設計フェーズに入る前に、高リスク項目を優先的に解消してください。
推定工数: **3-5人日**

---

## 未定義要素一覧

### 🔴 高リスク（即座の対応が必要）

#### 1. 在庫確認のタイミングが不明
- **カテゴリ**: 振る舞いの曖昧さ
- **説明**: 「在庫がある場合」の確認タイミングと方法が定義されていない
- **質問**:
  - 在庫確認はリアルタイムで行うか、キャッシュを使用するか？
  - 複数ユーザーが同時に同じ商品をカートに追加した場合の挙動は？
  - 在庫予約の仕組みは必要か？
- **想定される問題**: 
  - 同時購入による在庫マイナスの発生
  - 購入時に在庫切れエラーが頻発
- **推奨工程**: 設計フェーズで解消

#### 2. 「安全に」の具体的対策が不明
- **カテゴリ**: 非機能要件の曖昧さ（セキュリティ）
- **説明**: セキュリティ要件が抽象的で実装指針がない
- **質問**:
  - CSRF対策は必要か？
  - カート情報の保存場所は？（Cookie？サーバー？）
  - カートのセッション管理方法は？
  - 価格改ざん対策は？
- **想定される問題**:
  - 価格を改ざんして不正購入
  - CSRF攻撃によるカート操作
- **推奨工程**: 設計フェーズで解消

#### 3. 在庫減算のタイミングが不明
- **カテゴリ**: 振る舞いの曖昧さ
- **説明**: 「決済完了後」の具体的なタイミングが曖昧
- **質問**:
  - 決済完了とはどの時点か？（与信OK？決済完了通知受信？）
  - 決済と在庫減算のトランザクション境界は？
  - 在庫減算失敗時のロールバック方法は？
- **想定される問題**:
  - 決済完了後に在庫減算失敗
  - データ不整合
- **推奨工程**: 設計フェーズで解消

---

### 🟡 中リスク

#### 4. 価格のデータ仕様が不明
- **カテゴリ**: データ定義の欠落
- **推奨工程**: 要件定義に戻って解消
- **質問**: 価格の範囲、小数点、通貨単位は？

#### 5. 在庫切れ時のエラー処理が不明
- **カテゴリ**: エラーハンドリングの欠落
- **推奨工程**: 実装フェーズで解消
- **質問**: エラーメッセージ、代替商品提案の有無は？

#### 6. 「高速に」の具体的基準が不明
- **カテゴリ**: 非機能要件の曖昧さ（パフォーマンス）
- **推奨工程**: 設計フェーズで解消
- **質問**: 応答時間の目標値は？

#### 7. カートとユーザーの関係が不明
- **カテゴリ**: データ定義の欠落
- **推奨工程**: 要件定義に戻って解消
- **質問**: ログイン前後の扱い、複数デバイス同期は？

---

### 🟢 低リスク

#### 8. カート内の商品数上限が不明
- **カテゴリ**: 境界条件の未定義
- **推奨工程**: 設計フェーズで解消
- **質問**: 商品種類数、同一商品の数量上限は？

---

## リスク分析

### Top 3 リスク

| 順位 | 未定義要素 | リスクレベル | 発生時の影響 |
|------|-----------|-------------|-------------|
| 1 | 在庫の同時実行制御不備 | 最高危険度 | 在庫マイナス、出荷不可、顧客対応コスト |
| 2 | セキュリティ対策の欠如 | 最高危険度 | 不正購入、金銭的損失、信頼失墜 |
| 3 | トランザクション境界の不明確 | 高危険度 | データ不整合、会計監査での指摘 |

### 影響予測

- **スケジュール**: これらを放置すると、実装後に**2週間〜1ヶ月の手戻り**が発生する可能性
- **コスト**: 本番障害になった場合、**500万円〜2000万円の損失**（過去の類似事例より）
- **品質**: セキュリティ脆弱性により、リリース延期の可能性

---

## 推奨アクション

### 即座に対応すべき項目（今週中）

1. **在庫管理の同時実行制御を設計で明確化**
   - 担当: アーキテクト
   - 工数: 4時間
   - 成果物: トランザクション設計書、シーケンス図

2. **セキュリティ要件の明確化**
   - 担当: PM + アーキテクト
   - 工数: 2時間
   - 成果物: セキュリティ設計書

3. **決済フローの詳細化**
   - 担当: アーキテクト
   - 工数: 3時間
   - 成果物: 決済シーケンス図、エラーハンドリング仕様

### クイックウィン（短時間で効果大）

- **価格のデータ仕様を要件に追記** (30分、リスク削減: 中)
- **カート上限を決定** (15分、リスク削減: 低)

---

## 次のステップ

1. このレポートをチーム内で共有
2. 高リスク項目の解消ミーティングを設定（推奨: 今週中）
3. 要件定義書を更新
4. 更新後、再度このツールで分析（未定義要素の減少を確認）

---

## 付録

### 参考: 過去の類似障害事例

- **某ECサイト**: 在庫管理の不備で1000件の過剰注文、500万円の損失
- **某小売チェーン**: 価格改ざん脆弱性により不正購入、1500万円の被害

### 用語解説

- **CSRF**: Cross-Site Request Forgery（クロスサイトリクエストフォージェリ）。悪意のあるサイトから正規サイトへのリクエストを偽装する攻撃
- **トランザクション境界**: 複数の処理を一括で成功/失敗させる単位




