# 未定義要素検出器 v2.0 (Undefined Spec Detector)

## 🎉 v2.0 - コンテキスト駆動型への全面改修完了！

**未定義要素検出器 v2.0** は、自然言語で書かれた要件や仕様から「定義されていない要素」を**文脈を理解した上で**自動的に検出し、実務で使える質問文を生成するツールです。

### 🆕 v2.0の新機能

#### 1. 🎯 処理タイプ自動分類
入力された作業指示から処理タイプを自動判定します。

- **削除系** - 論理/物理削除、復元、カスケード削除など
- **外部連携系** - タイムアウト、リトライ、フォールバックなど
- **認証系** - 認証方式、トークン管理など
- その他多数の処理タイプに対応

```
入力: "ユーザーを削除する機能を作る"
↓
🎯 処理タイプ: 削除系（危険度: HIGH）
```

#### 2. 🔴🟡🟢 致命度判定エンジン
未定義項目を3段階で自動判定します。

- **🔴 着手不可** - 未定義のまま実装開始は危険
- **🟡 要確認** - 仮置きで進められるが確認必要
- **🟢 後決めOK** - 実装中に決めても間に合う

各項目に「変更コスト」「推奨決定タイミング」「確認先」を自動提示します。

#### 3. 💡 実践的質問文生成
若手SEがそのまま使える質問文を生成します。

```markdown
【削除機能について】
ユーザーの削除は、以下のどちらの方式で実装しますか？

A) 論理削除（deleted_atフラグ）
   - メリット: 復元可能、履歴が残る
   - デメリット: データ容量増加、クエリ複雑化

B) 物理削除（レコード完全削除）
   - メリット: シンプル、容量節約
   - デメリット: 復元不可、履歴なし

👉 この決定は後から変更困難です（DB全体の再設計が必要）
👉 確認先: プロダクトオーナー、または上長
```

#### 4. 📋 処理タイプ別チェックリスト
各処理タイプに最適化されたチェックリストを自動適用します。

**削除系のチェック項目例:**
- 論理削除 vs 物理削除
- 復元可能性
- カスケード削除の範囲
- 削除権限
- 削除ログの記録
- 削除確認ダイアログ
- 一括削除の対応

**外部連携系のチェック項目例:**
- タイムアウト設定
- リトライ戦略
- フォールバック処理
- 認証情報の管理
- レスポンスバリデーション
- レート制限対応

#### 5. 📝 意思決定記録システム
要件定義時の意思決定を記録・追跡できます。

- ✅ 確認済み事項
- 🟡 仮置き事項
- 💡 自己判断事項
- ⚠️ 未解決事項

「聞いてない」問題を防ぐ証跡レポートを自動生成します。

---

## 🚀 クイックスタート

### Web アプリケーション（推奨）

```bash
# 1. 依存パッケージをインストール
pip install -r requirements.txt

# 2. Webサーバーを起動
python -m uvicorn usd.web_api:app --reload

# または、スクリプトを使用（Windows）
.\start_web.ps1

# または、スクリプトを使用（Mac/Linux）
./start_web.sh
```

ブラウザで以下にアクセス：
- **Webアプリ**: http://localhost:8000/app
- **API ドキュメント**: http://localhost:8000/docs

### Docker を使用（簡単！）

```bash
# Docker Composeで起動
docker-compose up

# ブラウザで http://localhost:8000/app にアクセス
```

### コマンドライン（CLI）

```bash
# CLIで分析
usd-cli analyze --input examples/input-sample-ec-cart.md

# 結果をファイルに保存
usd-cli analyze --input requirements.txt --output report.md --format markdown
```

### Python API

```python
from usd.coordinator import AnalysisCoordinator

content = """
ユーザーを削除する機能を作る
"""

coordinator = AnalysisCoordinator()
report = coordinator.analyze(content)

print(f"処理タイプ: {report['action_classification']['action_type']}")
print(f"🔴 着手不可: {report['undefined_elements']['by_criticality']['must_define']}件")
```

---

## 📱 v2.0の使い方

### 入力例1: 削除機能

```
ユーザーを削除する機能を作る
```

### 出力例1

```
🎯 処理タイプ: 削除系（危険度: HIGH）

📋 チェック結果:

🔴 着手不可（即決必要）
───────────────────
1. 削除方式の選択
   Q: 論理削除 vs 物理削除？
   理由: DB設計の根幹、後から変更すると全面再設計
   確認先: プロダクトオーナー

2. カスケード削除の範囲
   Q: 関連データ（投稿、コメント）の扱いは？
   理由: 一度削除したデータは復元できない
   確認先: プロダクトオーナー

🟡 要確認（仮置き可）
───────────────────
3. 削除権限
   仮置き: 本人のみ
   確認推奨時期: 実装開始前

🟢 後決めOK
───────────────────
4. 削除ログの記録
   デフォルト: 記録する
   理由: 実装コスト低、後から追加も容易
```

### 入力例2: 外部API連携

```
LINEのクーポン配信機能を作る
```

### 出力例2

```
🎯 処理タイプ: 外部連携系（危険度: HIGH）

📋 チェック結果:

🔴 着手不可（即決必要）
───────────────────
1. タイムアウト設定
   Q: LINE API呼び出しは何秒でタイムアウト？
   選択肢: 5秒/10秒/30秒
   理由: 無限待機するとシステム全体が停止
   確認先: インフラチーム

2. フォールバック処理
   Q: API障害時の代替挙動は？
   選択肢: キャッシュ/エラー画面/キュー
   理由: 外部システムは必ず障害が起きる
   確認先: 外部連携担当

3. 認証情報の管理
   Q: APIキーはどこに保存？
   理由: セキュリティリスク
   確認先: セキュリティチーム
```

---

## 🏗️ v2.0のアーキテクチャ

```
入力（自然文の作業指示）
  ↓
【① ActionTypeClassifier】
  処理タイプを自動分類
  ↓
【② テンプレート駆動未定義抽出】
  処理タイプ別チェックリストを適用
  ↓
【③ CriticalityJudge】
  致命度を判定（🔴🟡🟢）
  ↓
【④ QuestionGenerator】
  実践的な質問文を生成
  ↓
【⑤ DecisionTracker】
  意思決定を記録
  ↓
出力（構造化されたレポート）
```

---

## 📊 v1.0との比較

| 機能 | v1.0 | v2.0 |
|------|------|------|
| 未定義検出 | ✅ 表面的 | ✅ 文脈理解 |
| 処理タイプ分類 | ❌ なし | ✅ 自動分類 |
| 致命度判定 | ❌ なし | ✅ 3段階判定 |
| 質問文 | ⚠️ 汎用的 | ✅ 実践的 |
| チェックリスト | ❌ なし | ✅ タイプ別 |
| 意思決定記録 | ❌ なし | ✅ 証跡管理 |
| 重複検出 | ❌ 8個同じ | ✅ 重複排除 |

---

## 🔧 技術スタック

### バックエンド
- **Python 3.10+**
- **FastAPI**: Web API フレームワーク
- **Uvicorn**: ASGI サーバー
- **Pydantic**: データバリデーション
- **PyYAML**: チェックリスト管理

### 新規モジュール（v2.0）
- **ActionClassifier**: 処理タイプ分類
- **CriticalityJudge**: 致命度判定
- **QuestionGenerator**: 質問文生成
- **DecisionTracker**: 意思決定記録

### フロントエンド
- **HTML/CSS/JavaScript**: シンプルで美しいUI
- 致命度別の色分け表示
- リアルタイム分析

---

## 📁 プロジェクト構成（v2.0）

```
undefined-spec-detector/
├── src/
│   └── usd/
│       ├── modules/
│       │   ├── action_classifier/       # ⭐NEW
│       │   ├── criticality_judge/       # ⭐NEW
│       │   ├── question_generator/      # ⭐NEW
│       │   ├── decision_tracker/        # ⭐NEW
│       │   ├── requirement_parser/
│       │   └── undefined_extractor/     # ⭐UPDATED
│       ├── coordinator.py               # ⭐UPDATED
│       ├── schema.py                    # ⭐UPDATED
│       └── web_api.py
├── templates/
│   └── action_checklists/               # ⭐NEW
│       ├── delete.yaml
│       ├── external_api.yaml
│       └── authentication.yaml
├── web/
│   └── index.html                       # ⭐UPDATED
└── quick_test.py                        # ⭐NEW
```

---

## 🎯 実務での使い方

### ケース1: タスクチケットを受け取ったとき

```
1. 作業指示をコピペ
   「ユーザー削除機能を実装してください」

2. Webアプリで分析

3. 🔴着手不可項目をPOに確認
   → Slackで質問文をそのまま送信

4. 確認済みの回答をDecisionTrackerに記録

5. 実装開始
```

### ケース2: 仕様書をレビューするとき

```
1. 仕様書の章ごとに分析

2. 🔴🟡項目をリスト化

3. レビュー会議で確認

4. 議事録として意思決定記録を出力
```

---

## 💡 v2.0の設計思想

### 従来の問題点
- **単調な検出**: 「エラー処理が未定義」が8個も並ぶ
- **文脈の欠如**: 削除が論理削除か物理削除かわからない
- **実用性がない**: 若手SEが実際に使える質問文になっていない

### v2.0の解決策
- **文脈理解**: 処理タイプを理解した上で検出
- **致命度判定**: 本当に危険なものを区別
- **実践的**: そのまま使える質問文と選択肢
- **証跡管理**: 「聞いてない」問題を防ぐ

---

## 🎓 サポートされる処理タイプ

| 処理タイプ | 危険度 | 主なチェック項目 |
|-----------|--------|----------------|
| 削除系 | HIGH | 論理/物理、復元、カスケード |
| 外部連携系 | HIGH | タイムアウト、リトライ、フォールバック |
| 認証系 | CRITICAL | 認証方式、トークン管理 |
| データ移行系 | HIGH | ロールバック、バリデーション |
| 作成系 | MEDIUM | 必須項目、重複チェック |
| 更新系 | MEDIUM | 更新権限、履歴記録 |
| 表示系 | LOW | ページネーション、ソート |
| 検索系 | MEDIUM | 検索対象、パフォーマンス |
| 通知系 | MEDIUM | 通知タイミング、失敗処理 |
| バッチ処理系 | MEDIUM | 実行タイミング、エラー通知 |

---

## 📖 ドキュメント

- [アーキテクチャ設計](docs/architecture.md)
- [ユースケース集](docs/use-cases.md)
- [モジュール仕様](docs/module-specs.md)
- [今後の拡張案](docs/future-extensions.md)

---

## 🐛 トラブルシューティング

### ポート8000が使用中の場合

```bash
uvicorn usd.web_api:app --port 8001
```

### パッケージが見つからない

```bash
pip install -r requirements.txt
```

---

## 📝 更新履歴

### v2.0.0 (2026-01-07)
- 🎯 処理タイプ自動分類機能
- 🔴🟡🟢 致命度判定エンジン
- 💡 実践的質問文生成器
- 📋 処理タイプ別チェックリスト
- 📝 意思決定記録システム
- 🎨 UI改善（致命度表示対応）
- 🐛 重複検出の問題を修正

### v1.0.0 (2026-01-07)
- 初回リリース
- 基本的な未定義要素検出
- Web アプリケーション
- CLI実装

---

## 🤝 貢献

プルリクエスト、バグ報告、機能提案を歓迎します！

---

## 📧 連絡先

AI System Architect

---

**バージョン**: 2.0.0 (コンテキスト駆動型)  
**最終更新**: 2026年1月7日

🎉 **v2.0で、より実務に役立つツールになりました！**



