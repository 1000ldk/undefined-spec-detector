# LLMçµ±åˆå®Ÿè£…å®Œäº†ã‚¬ã‚¤ãƒ‰

## å®Ÿè£…å®Œäº†ã‚µãƒžãƒªãƒ¼

OpenAI GPT-4oã‚’ä½¿ç”¨ã—ãŸLLMæ©Ÿèƒ½ãŒæœªå®šç¾©è¦ç´ æ¤œå‡ºå™¨ã«çµ±åˆã•ã‚Œã¾ã—ãŸã€‚

### å®Ÿè£…ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«

1. âœ… **src/usd/llm/__init__.py** (æ–°è¦ä½œæˆ)
2. âœ… **src/usd/llm/llm_detector.py** (æ–°è¦ä½œæˆ)
   - `LLMUnknownTermDetector`: æœªçŸ¥ã®ç”¨èªžæ¤œå‡º
   - `LLMContextualAmbiguityDetector`: æ–‡è„ˆä¾å­˜ã®æ›–æ˜§ã•æ¤œå‡º
   - `LLMQuestionGenerator`: å®Ÿè·µçš„ãªè³ªå•ç”Ÿæˆ
3. âœ… **src/usd/modules/undefined_extractor/extractor.py** (å¤‰æ›´)
   - LLMæ¤œå‡ºæ©Ÿèƒ½ã‚’çµ±åˆ
   - é‡è¤‡æŽ’é™¤æ©Ÿèƒ½ã‚’è¿½åŠ 
4. âœ… **src/usd/cli.py** (å¤‰æ›´)
   - `--use-llm` ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ 
   - `--openai-api-key` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 
5. âœ… **src/usd/web_api.py** (å¤‰æ›´)
   - `use_llm` ã¨ `api_key` ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«è¿½åŠ 
6. âœ… **src/usd/coordinator.py** (å¤‰æ›´)
   - LLMãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹ã‚ˆã†ã«å¤‰æ›´
7. âœ… **requirements.txt** (å¤‰æ›´)
   - `openai>=1.50.0` ã‚’è¿½åŠ 
8. âœ… **test_llm_integration.py** (æ–°è¦ä½œæˆ)

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pip install -r requirements.txt
```

### 2. OpenAI API Keyã®è¨­å®š

ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®æ–¹æ³•ã§APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š

#### æ–¹æ³•1: ç’°å¢ƒå¤‰æ•°ï¼ˆæŽ¨å¥¨ï¼‰

**Windows (PowerShell):**
```powershell
$env:OPENAI_API_KEY = "sk-your-api-key-here"
```

**Windows (ã‚³ãƒžãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ):**
```cmd
set OPENAI_API_KEY=sk-your-api-key-here
```

**Mac/Linux:**
```bash
export OPENAI_API_KEY="sk-your-api-key-here"
```

#### æ–¹æ³•2: ã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
usd-cli analyze --input test.md --use-llm --openai-api-key "sk-your-api-key-here"
```

## ä½¿ç”¨æ–¹æ³•

### CLIï¼ˆã‚³ãƒžãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰

#### ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿ï¼ˆå¾“æ¥é€šã‚Šï¼‰
```bash
usd-cli analyze --input examples/input-sample-ec-cart.md
```

#### LLMçµ±åˆãƒ¢ãƒ¼ãƒ‰
```bash
# ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ç”¨
usd-cli analyze --input examples/input-sample-ec-cart.md --use-llm

# APIã‚­ãƒ¼ã‚’ç›´æŽ¥æŒ‡å®š
usd-cli analyze --input examples/input-sample-ec-cart.md --use-llm --openai-api-key "sk-..."
```

### Web API

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼ˆLLMãªã—ï¼‰
```json
POST /api/analyze
{
  "content": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å•†å“ã‚’ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã§ãã‚‹ã€‚"
}
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¾‹ï¼ˆLLMã‚ã‚Šï¼‰
```json
POST /api/analyze
{
  "content": "æ—¢å­˜ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æºã™ã‚‹æ–°ã—ã„ç®¡ç†ç”»é¢ã‚’é–‹ç™ºã™ã‚‹ã€‚",
  "use_llm": true,
  "api_key": "sk-your-api-key-here"
}
```

#### curlã§ã®å®Ÿè¡Œä¾‹
```bash
curl -X POST "http://localhost:8000/api/analyze" \
  -H "Content-Type: application/json" \
  -d '{
    "content": "æ—¢å­˜ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æºã™ã‚‹æ–°ã—ã„ç®¡ç†ç”»é¢ã‚’é–‹ç™ºã™ã‚‹ã€‚",
    "use_llm": true,
    "api_key": "sk-your-api-key-here"
  }'
```

### Python API

```python
from usd.coordinator import AnalysisCoordinator

content = """
æ—¢å­˜ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¨é€£æºã™ã‚‹æ–°ã—ã„ç®¡ç†ç”»é¢ã‚’é–‹ç™ºã™ã‚‹ã€‚
ãƒœã‚¿ãƒ³ãŒè¡¨ç¤ºé ˜åŸŸã¨é‡ãªã‚‹å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚
å¯¾å‡¦ã¨ã—ã¦ãƒžãƒ¼ã‚¸ãƒ³ã‚’èª¿æ•´ã™ã‚‹äºˆå®šã€‚
"""

# LLMãªã—
coordinator = AnalysisCoordinator(use_llm=False)
report = coordinator.analyze(content)

# LLMã‚ã‚Š
coordinator = AnalysisCoordinator(use_llm=True, api_key="sk-...")
report = coordinator.analyze(content)
```

## ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### çµ±åˆãƒ†ã‚¹ãƒˆ
```bash
# OpenAI API Keyã‚’ç’°å¢ƒå¤‰æ•°ã«è¨­å®š
export OPENAI_API_KEY="sk-your-api-key-here"

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python test_llm_integration.py
```

### æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›ä¾‹
```
============================================================
æœªå®šç¾©è¦ç´ æ¤œå‡ºå™¨ - LLMçµ±åˆãƒ†ã‚¹ãƒˆ
============================================================

============================================================
LLMçµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹
============================================================

ðŸ“ è¦ä»¶ã‚’ãƒ‘ãƒ¼ã‚¹ä¸­...
âœ“ ãƒ‘ãƒ¼ã‚¹å®Œäº†: 3æ–‡, 5å€‹ã®ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£

ðŸ” ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿ã§æ¤œå‡ºä¸­...
âœ“ æ¤œå‡ºå®Œäº†: 12å€‹

ðŸ¤– LLMçµ±åˆãƒ¢ãƒ¼ãƒ‰ã§æ¤œå‡ºä¸­...
âœ“ LLMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆæœŸåŒ–ä¸­...
âœ“ LLMãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆæœŸåŒ–å®Œäº†

ðŸ¤– LLMï¼ˆgpt-4oï¼‰ã§æœªçŸ¥ã®ç”¨èªžã‚’æ¤œå‡ºä¸­...
âœ“ å®Œäº†ï¼ˆ2.3ç§’ï¼‰
  å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 450, å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 280
  ã‚³ã‚¹ãƒˆ: $0.0065 (ç´¯è¨ˆ: $0.0065)
âœ“ 3å€‹ã®æœªçŸ¥ã®ç”¨èªžã‚’æ¤œå‡º

ðŸ¤– LLMï¼ˆgpt-4oï¼‰ã§æ–‡è„ˆä¾å­˜ã®æ›–æ˜§ã•ã‚’æ¤œå‡ºä¸­...
âœ“ å®Œäº†ï¼ˆ2.1ç§’ï¼‰
  å…¥åŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 520, å‡ºåŠ›ãƒˆãƒ¼ã‚¯ãƒ³: 310
  ã‚³ã‚¹ãƒˆ: $0.0072 (ç´¯è¨ˆ: $0.0137)
âœ“ 2å€‹ã®æ›–æ˜§ã•ã‚’æ¤œå‡º

âœ“ LLMã§åˆè¨ˆ 5 å€‹æ¤œå‡º
âœ“ æ¤œå‡ºå®Œäº†: 17å€‹

============================================================
ðŸ“Š ãƒ†ã‚¹ãƒˆçµæžœ
============================================================
ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®ã¿: 12å€‹
LLMçµ±åˆå¾Œ:       17å€‹
ã†ã¡LLMã§æ¤œå‡º:   5å€‹

æ¤œå‡ºæ–¹æ³•åˆ¥:
  - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ: 10ä»¶
  - ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹: 2ä»¶
  - LLM: 5ä»¶

ðŸ¤– LLMã§æ¤œå‡ºã•ã‚ŒãŸæœªå®šç¾©è¦ç´ :

1. ã€Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã€ã®å®šç¾©ãŒä¸æ˜Ž
   ã‚«ãƒ†ã‚´ãƒª: æœªçŸ¥ã®ç”¨èªžãƒ»æ¦‚å¿µ
   ä¿¡é ¼åº¦: 0.92
   èª¬æ˜Ž: ã€Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã€ã¯æ–‡ä¸­ã§å®šç¾©ã•ã‚Œã¦ãŠã‚‰ãšã€æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°ãŒä¸æ˜Ž...

============================================================
âœ… ãƒ†ã‚¹ãƒˆè©•ä¾¡
============================================================
âœ“ LLMã«ã‚ˆã‚Šè¿½åŠ ã®æœªå®šç¾©è¦ç´ ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ
âœ“ LLMã§5å€‹ã®æœªå®šç¾©è¦ç´ ã‚’æ¤œå‡º
âœ“ çµ±è¨ˆæƒ…å ±ã«LLMæ¤œå‡ºãŒè¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã™

============================================================
ðŸŽ‰ ãƒ†ã‚¹ãƒˆæˆåŠŸï¼
============================================================
```

## ä¸»ãªæ©Ÿèƒ½

### 1. æœªçŸ¥ã®ç”¨èªžæ¤œå‡º
- è¾žæ›¸ã«ç™»éŒ²ã•ã‚Œã¦ã„ãªã„å›ºæœ‰åè©žã‚„å°‚é–€ç”¨èªžã‚’æ¤œå‡º
- ã€Œæ—¢å­˜ã®ã€œã€ã€Œç¤¾å†…ã®ã€œã€ãªã©ã®å¤–éƒ¨å‚ç…§ã‚’æ¤œå‡º
- ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ä»˜ã

### 2. æ–‡è„ˆä¾å­˜ã®æ›–æ˜§ã•æ¤œå‡º
- ã€Œã€œã™ã‚‹äºˆå®šã€ãªã©ã®å…·ä½“æ€§ã«æ¬ ã‘ã‚‹è¡¨ç¾ã‚’æ¤œå‡º
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®æ¬ è½ã‚’æ¤œå‡º
- å¢ƒç•Œæ¡ä»¶ã®æœªå®šç¾©ã‚’æ¤œå‡º
- å®Ÿè£…æ™‚ã«å›°ã‚‹ç‚¹ã‚’å…·ä½“çš„ã«æŒ‡æ‘˜

### 3. å®Ÿè·µçš„ãªè³ªå•ç”Ÿæˆ
- ã‚¹ãƒ†ãƒ¼ã‚¯ãƒ›ãƒ«ãƒ€ãƒ¼ã«ç¢ºèªã™ã¹ãè³ªå•ã‚’è‡ªå‹•ç”Ÿæˆ
- é¸æŠžè‚¢ä»˜ãã®è³ªå•ã‚‚ç”Ÿæˆ
- èª°ã«èžãã¹ãã‹ã‚’æ˜Žç¤º

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### LLMå¤±æ•—æ™‚ã®å‹•ä½œ
- APIå‘¼ã³å‡ºã—ãŒå¤±æ•—ã—ã¦ã‚‚ã‚¢ãƒ—ãƒªå…¨ä½“ã¯åœæ­¢ã—ãªã„
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã®çµæžœã¯å¿…ãšè¿”ã•ã‚Œã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ­ã‚°å‡ºåŠ›

### ã‚³ã‚¹ãƒˆç®¡ç†
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚³ã‚¹ãƒˆä¸Šé™: $1.00
- ãƒˆãƒ¼ã‚¯ãƒ³æ•°ã‚’ãƒ­ã‚°å‡ºåŠ›
- ã‚³ã‚¹ãƒˆä¸Šé™ã‚’è¶…ãˆãŸå ´åˆã¯è­¦å‘Šã—ã¦åœæ­¢

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 30ç§’
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦ç¶™ç¶š

## åˆ¶ç´„ãƒ»æ³¨æ„äº‹é …

### æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¸ã®å½±éŸ¿
- âœ… `--use-llm` ãƒ•ãƒ©ã‚°ãªã—ã®å ´åˆã€æ—¢å­˜ã®å‹•ä½œã‚’å®Œå…¨ã«ç¶­æŒ
- âœ… æ—¢å­˜ã®ãƒ†ã‚¹ãƒˆã¯å…¨ã¦é€šã‚‹
- âœ… ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚­ãƒ¼ãƒžã¯å¤‰æ›´ã—ã¦ã„ãªã„ï¼ˆOptionalãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿è¿½åŠ ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹
- LLMå‘¼ã³å‡ºã—ã¯é€šå¸¸2-5ç§’ã‹ã‹ã‚Šã¾ã™
- é•·ã„è¦ä»¶æ–‡ã®å ´åˆã€ã•ã‚‰ã«æ™‚é–“ãŒã‹ã‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
- éžåŒæœŸåŒ–ã¯å°†æ¥ã®æ”¹å–„ã¨ã—ã¦æ¤œè¨Ž

### ã‚³ã‚¹ãƒˆ
- GPT-4oã¯æ¯”è¼ƒçš„å®‰ä¾¡ã§ã™ãŒã€å¤§é‡ã®è¦ä»¶æ–‡ã‚’å‡¦ç†ã™ã‚‹å ´åˆã¯ã‚³ã‚¹ãƒˆã«æ³¨æ„
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ $1.00 ã®ä¸Šé™ã‚’è¨­å®š

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### openaiãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„
```bash
pip install openai>=1.50.0
```

### APIã‚­ãƒ¼ãŒç„¡åŠ¹
```
âŒ LLMæ¤œå‡ºã‚¨ãƒ©ãƒ¼: Error code: 401 - {'error': {...}}
```
â†’ APIã‚­ãƒ¼ãŒæ­£ã—ã„ã‹ç¢ºèªã—ã¦ãã ã•ã„

### ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼
```
âš ï¸  LLMæ¤œå‡ºã«å¤±æ•—ã—ã¾ã—ãŸãŒã€å‡¦ç†ã‚’ç¶šè¡Œã—ã¾ã™: Request timed out
```
â†’ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„

### ã‚³ã‚¹ãƒˆä¸Šé™ã‚¨ãƒ©ãƒ¼
```
ã‚³ã‚¹ãƒˆä¸Šé™ï¼ˆ$1.00ï¼‰ã‚’è¶…éŽã—ã¾ã—ãŸã€‚ç¾åœ¨ã®ã‚³ã‚¹ãƒˆ: $1.05
```
â†’ ã‚³ã‚¹ãƒˆä¸Šé™ã‚’å¼•ãä¸Šã’ã‚‹ã‹ã€å‡¦ç†ã‚’åˆ†å‰²ã—ã¦ãã ã•ã„

## ä»Šå¾Œã®æ”¹å–„æ¡ˆ

1. **éžåŒæœŸåŒ–**: LLMå‘¼ã³å‡ºã—ã‚’éžåŒæœŸåŒ–ã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸Š
2. **ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°**: åŒã˜è¦ä»¶æ–‡ã®çµæžœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›
3. **ãƒãƒƒãƒå‡¦ç†**: è¤‡æ•°ã®è¦ä»¶æ–‡ã‚’ä¸€åº¦ã«å‡¦ç†
4. **ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ
5. **ä»–ã®LLMå¯¾å¿œ**: Claudeã€Geminiç­‰ã®ã‚µãƒãƒ¼ãƒˆ

## ãƒãƒ¼ã‚¸ãƒ§ãƒ³æƒ…å ±

- **ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.1.0-hybrid
- **LLMãƒ¢ãƒ‡ãƒ«**: gpt-4o
- **openaiãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: >=1.50.0

---

**å®Ÿè£…å®Œäº†æ—¥**: 2026å¹´1æœˆ8æ—¥
