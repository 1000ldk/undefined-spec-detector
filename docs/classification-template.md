# 未定義要素の分類テンプレート

## 概要

このテンプレートは、自然言語で書かれた要件や仕様から未定義要素を体系的に抽出するためのフレームワークです。

## 分類軸

未定義要素は以下の6つの主要カテゴリと、3つの横断的視点で分類されます。

---

## 主要カテゴリ

### 1. データ定義の欠落 (Data Definition Gap)

**定義**: データの構造、形式、制約が明確でない状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **型定義** | データ型は明確か | 「日付」→ ISO8601? Unix timestamp? |
| **制約条件** | 最小値・最大値・桁数は？ | 「名前」→ 最大文字数は？ |
| **フォーマット** | 入力形式の規則は？ | 「電話番号」→ ハイフンあり？国際形式？ |
| **必須/任意** | nullを許容するか | 「住所」→ 必須項目？任意？ |
| **初期値** | デフォルト値は何か | 「ステータス」→ 初期値は？ |
| **一意性** | 重複を許すか | 「メールアドレス」→ ユニーク制約は？ |
| **値の範囲** | 有効な値の集合は？ | 「年齢」→ 0-150の範囲？ |
| **リレーション** | 他データとの関係は？ | 「注文」→ ユーザーIDは必須外部キー？ |

#### 検出パターン
```yaml
triggers:
  - "データ", "情報", "値", "項目"を含む文で、具体的な型や制約の記述がない
  - "〜とする", "〜を持つ"の後に具体的な定義がない
  - 数値・日付・文字列の言及があるが、フォーマットが不明

example:
  input: "ユーザー名を保存する"
  undefined_elements:
    - type: データ型（string? varchar? 最大長は？）
    - constraint: 使用可能文字（英数字のみ？記号は？）
    - uniqueness: 重複許可（同名ユーザーは可能？）
```

---

### 2. 振る舞いの曖昧さ (Behavior Ambiguity)

**定義**: システムの動作やプロセスの手順が複数解釈可能な状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **実行順序** | 処理の順番は定義されているか | 「検証して保存」→ 検証失敗時も保存？ |
| **実行条件** | いつ実行されるか | 「定期的に」→ 何分おき？ |
| **終了条件** | どこで処理が完了するか | 「処理が終わるまで」→ 何を持って終了？ |
| **同期/非同期** | 完了を待つか | 「メール送信」→ 送信完了を待つ？ |
| **冪等性** | 複数回実行しても安全か | 「データ登録」→ 重複実行時は？ |
| **副作用** | 他への影響は？ | 「削除」→ 関連データも削除？ |
| **トランザクション** | どこまでがアトミック？ | 「注文確定」→ どの処理まで一括？ |

#### 検出パターン
```yaml
triggers:
  - "〜する", "〜される"の記述で、条件や順序が不明
  - 時間表現（「後で」「すぐに」「定期的に」）の具体性欠如
  - 動詞のみで目的語や条件が省略されている

example:
  input: "パスワードを変更する"
  undefined_elements:
    - timing: いつ反映されるか（即座？次回ログイン時？）
    - session: 他のセッションは無効化されるか
    - notification: 変更通知はメール送信されるか
    - history: 変更履歴は記録されるか
```

---

### 3. 責任分担の不明確さ (Responsibility Gap)

**定義**: 誰が・何が・どこで実行/判断/保証するかが未定義の状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **実行主体** | クライアント側？サーバー側？ | 「バリデーション」→ どちらで？ |
| **判断権限** | 誰が承認・拒否するか | 「申請承認」→ 自動？手動？ |
| **データ保証** | どこが真の情報源か | 「在庫数」→ DBか外部APIか？ |
| **エラー処理** | どこで例外を捕捉するか | 「エラー処理」→ どのレイヤー？ |
| **監視責任** | 誰が監視・通知するか | 「異常検知」→ システム？人？ |
| **ログ記録** | 誰が何をログに残すか | 「監査ログ」→ どのレイヤーで？ |

#### 検出パターン
```yaml
triggers:
  - 主語が省略されている文
  - "チェックする", "確認する"の主体が不明
  - "〜される"の受動態で実行者が不明

example:
  input: "入力値をチェックする"
  undefined_elements:
    - who: フロントエンド？バックエンド？両方？
    - when: 入力中？送信時？
    - feedback: エラー表示は誰が？
```

---

### 4. 境界条件の未定義 (Boundary Condition Gap)

**定義**: 正常系と異常系の境界、限界値、特殊ケースが明確でない状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **上限/下限** | リソースの限界は？ | 「ファイルアップロード」→ サイズ上限は？ |
| **空集合** | 0件の場合の挙動は？ | 「検索結果を表示」→ 0件時は？ |
| **最初/最後** | 端の要素の扱いは？ | 「前のページ」→ 1ページ目では？ |
| **同時実行** | 並列処理の限界は？ | 「同時ログイン」→ 上限は？ |
| **タイムアウト** | 待機時間の上限は？ | 「APIリクエスト」→ 何秒待つ？ |
| **リトライ** | 失敗時の再試行は？ | 「接続エラー」→ 何回リトライ？ |
| **レート制限** | 単位時間あたりの制限は？ | 「API呼び出し」→ 秒間何回まで？ |

#### 検出パターン
```yaml
triggers:
  - 数量・サイズ・時間の言及で具体的な値がない
  - "複数", "大量", "多数"などの曖昧な量的表現
  - 繰り返し・ループ処理で終了条件が不明

example:
  input: "ユーザーは複数の画像をアップロードできる"
  undefined_elements:
    - max_count: 何枚まで？
    - max_size: 1枚あたりのサイズは？
    - total_size: 合計サイズの制限は？
    - formats: 許可する画像形式は？
```

---

### 5. エラーハンドリングの欠落 (Error Handling Gap)

**定義**: 異常系・例外処理・エラー時の挙動が定義されていない状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **検出方法** | エラーをどう検知するか | 「不正な入力」→ どう判定？ |
| **通知方法** | エラーをどう伝えるか | 「エラー表示」→ どこに？形式は？ |
| **リカバリ** | 復旧手段は？ | 「処理失敗」→ ロールバック？再試行？ |
| **ログ記録** | エラーを記録するか | 「例外発生」→ どのレベルでログ？ |
| **ユーザー影響** | ユーザーに見せる情報は？ | 「システムエラー」→ 詳細は表示？ |
| **状態保存** | エラー時の状態は？ | 「保存失敗」→ 入力内容は保持？ |
| **代替手段** | フォールバック処理は？ | 「外部API障害」→ 代替手段は？ |

#### 検出パターン
```yaml
triggers:
  - 正常系の記述のみで、異常系の言及がない
  - "〜できる"という記述で、"できない場合"の記述がない
  - 外部依存（API、DB、ファイル）の言及でエラー処理の記述がない

example:
  input: "外部APIから天気情報を取得して表示する"
  undefined_elements:
    - api_failure: API障害時の表示は？
    - timeout: タイムアウト時の挙動は？
    - invalid_response: 不正なレスポンス時は？
    - retry: リトライするか？
```

---

### 6. 非機能要件の曖昧さ (Non-Functional Requirement Gap)

**定義**: パフォーマンス、セキュリティ、運用性などの品質特性が未定義の状態

#### サブカテゴリ

| サブカテゴリ | チェック項目 | 例 |
|------------|------------|-----|
| **パフォーマンス** | 応答時間・スループットは？ | 「高速に」→ 何秒以内？ |
| **可用性** | 稼働率・ダウンタイムは？ | 「安定稼働」→ 99.9%？ |
| **セキュリティ** | 認証・認可・暗号化は？ | 「セキュアに」→ 具体的には？ |
| **スケーラビリティ** | どこまで拡張可能か？ | 「拡張性」→ 何ユーザーまで？ |
| **保守性** | ログ・監視・バックアップは？ | 「運用」→ 何を監視？ |
| **互換性** | 対応ブラウザ・OS・バージョンは？ | 「Webアプリ」→ どのブラウザ？ |
| **アクセシビリティ** | 障害者対応は？ | 「誰でも使える」→ WCAG準拠？ |

#### 検出パターン
```yaml
triggers:
  - "速い", "安全", "使いやすい"など形容詞のみで具体性がない
  - "〜に対応"の記述で、具体的な基準がない
  - インフラ・デプロイに関する記述で、運用要件がない

example:
  input: "高速に検索できる"
  undefined_elements:
    - latency: 平均応答時間の目標値は？
    - throughput: 秒間何リクエストまで？
    - data_volume: 何件までのデータを想定？
    - cache_strategy: キャッシュ戦略は？
```

---

## 横断的視点

### A. 時間軸による分類

| 時間軸 | 観点 | 例 |
|-------|------|-----|
| **同期** | リアルタイム処理 | APIレスポンス時の即座の反映 |
| **非同期** | 遅延処理 | メール送信、バッチ処理 |
| **スケジュール** | 定期実行 | 日次集計、週次レポート |
| **イベント駆動** | トリガー処理 | Webhook、通知 |

### B. 影響範囲による分類

| 影響範囲 | 説明 | リスクレベル |
|---------|------|------------|
| **局所的** | 単一機能・画面に閉じる | 低 |
| **モジュール間** | 複数コンポーネントに跨る | 中 |
| **システム全体** | アーキテクチャレベル | 高 |
| **外部連携** | 他システムとの接続 | 高 |

### C. 発見困難度による分類

| 困難度 | 説明 | 検出タイミング |
|-------|------|--------------|
| **低** | レビューで発見可能 | 要件定義・設計 |
| **中** | 実装中に気づく | 実装・単体テスト |
| **高** | 統合後に顕在化 | 結合テスト・本番 |
| **最高** | 本番運用後に発覚 | 本番障害・監査 |

---

## 地雷（リスク）の評価基準

各未定義要素に対して、以下の4軸で地雷度を評価します。

### 評価軸

```yaml
risk_dimensions:
  probability:
    description: 問題が顕在化する確率
    levels:
      low: 特殊な条件でのみ発生
      medium: 一定の頻度で発生
      high: 高頻度で発生
      critical: ほぼ確実に発生
  
  impact:
    description: 顕在化した場合の影響度
    levels:
      low: 軽微なUX劣化
      medium: 機能の一部が使えない
      high: システム全体の停止
      critical: データ損失・法的問題
  
  detectability:
    description: 発見の困難さ
    levels:
      low: レビューで発見可能
      medium: テストで発見可能
      high: 本番環境でのみ発生
      critical: 事後調査で初めて発覚
  
  remediation_cost:
    description: 修正コスト
    levels:
      low: 数時間の修正
      medium: 数日の作業
      high: 設計の見直し必要
      critical: 要件定義からやり直し
```

### 総合リスクレベル

```python
# リスクスコアの計算式
risk_score = (probability * 0.3) + (impact * 0.4) + (detectability * 0.2) + (remediation_cost * 0.1)

# レベル判定
if risk_score >= 3.5: "最高危険度"
elif risk_score >= 2.5: "高危険度"
elif risk_score >= 1.5: "中危険度"
else: "低危険度"
```

---

## 修正推奨工程の判定ルール

```yaml
remediation_phase:
  requirement_definition:
    condition: ビジネスルール、データ定義、責任分担の根本的な不明確さ
    examples:
      - "誰がこの判断をするか"が不明
      - ビジネスロジックの前提が曖昧
      - ステークホルダー間の認識齟齬
  
  design:
    condition: アーキテクチャ、インターフェース、データモデルの未定義
    examples:
      - APIの入出力形式
      - データベーススキーマ
      - モジュール間の責任分担
  
  implementation:
    condition: 実装詳細、アルゴリズム、エラーハンドリングの未定義
    examples:
      - エラーメッセージの文言
      - バリデーションの具体的ロジック
      - ログ出力の詳細
  
  testing:
    condition: テストで検証すべき境界条件や異常系
    examples:
      - 境界値テスト
      - 負荷テスト
      - セキュリティテスト
```

---

## テンプレート使用例

### 入力（要件文）
```
ユーザーは商品をカートに追加できる。
在庫がある場合のみ追加可能。
```

### 出力（構造化された未定義要素）

```yaml
requirement_id: REQ-001
input_text: "ユーザーは商品をカートに追加できる。在庫がある場合のみ追加可能。"

undefined_elements:
  - id: UE-001
    category: 振る舞いの曖昧さ
    subcategory: 実行条件
    description: "在庫数の確認タイミングが不明"
    questions:
      - 在庫チェックはリアルタイム？キャッシュ？
      - カート追加中に他ユーザーが購入した場合は？
    risk:
      probability: high
      impact: medium
      detectability: medium
      remediation_cost: medium
      total_score: 2.7
      level: "高危険度"
    consequences:
      - "在庫切れ商品がカートに入る"
      - "購入時にエラーでユーザー体験悪化"
    recommended_phase: design
    recommended_action: "在庫確認の同時実行制御を設計で明確化"

  - id: UE-002
    category: データ定義の欠落
    subcategory: 制約条件
    description: "カート内の同一商品の扱いが不明"
    questions:
      - 同じ商品を複数回追加した場合、数量を増やす？個別に追加？
      - カート内の商品数上限は？
    risk:
      probability: medium
      impact: low
      detectability: low
      remediation_cost: low
      total_score: 1.3
      level: "低危険度"
    consequences:
      - "UXの一貫性欠如"
      - "カートのUIデザインに影響"
    recommended_phase: requirement_definition
    recommended_action: "ビジネス側と仕様を確認"

  - id: UE-003
    category: エラーハンドリングの欠落
    subcategory: ユーザー影響
    description: "在庫なしの場合のフィードバックが不明"
    questions:
      - エラーメッセージは？
      - 在庫復活の通知機能は？
      - 代替商品の提案は？
    risk:
      probability: high
      impact: low
      detectability: low
      remediation_cost: low
      total_score: 1.5
      level: "中危険度"
    consequences:
      - "ユーザーのフラストレーション"
      - "離脱率の上昇"
    recommended_phase: implementation
    recommended_action: "UXライティングとして実装時に決定"
```

---

## 分類テンプレートのメタ情報

```yaml
version: "1.0.0"
last_updated: "2026-01-07"
maintenance_note: "このテンプレートは実際の運用フィードバックに基づいて継続的に更新される"
```






