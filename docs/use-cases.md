# ユースケースと利用シナリオ

## 想定ユーザー

1. **プロジェクトマネージャー**: 要件の網羅性を確認し、リスクを早期に可視化
2. **アーキテクト**: 設計の前提条件と制約を明確化
3. **開発者**: 実装前に仕様の曖昧性を解消
4. **QAエンジニア**: テスト観点の抜け漏れを発見
5. **プロダクトオーナー**: ビジネス要件の矛盾や未定義領域を特定

## ユースケース

### UC-1: 新規プロジェクトの要件レビュー

**シナリオ**: 
顧客から受け取った要件定義書を元に、プロジェクトを開始する前に潜在的な問題を洗い出す。

**入力例**:
```
【要件】
ECサイトにユーザーレビュー機能を追加する。
ユーザーは商品を購入後にレビューを投稿できる。
レビューは5段階評価とコメントで構成される。
```

**期待される出力**:
```
【検出された未定義要素】

[データ定義の欠落]
- レビューの最大文字数は？
- 画像添付は可能か？
- 編集・削除は可能か？
- 匿名投稿は許可するか？

[振る舞いの曖昧さ]
- 「購入後」とは注文確定時？配送完了後？
- 同一商品に複数回レビュー可能か？
- レビュー投稿可能期間の制限は？

[責任の未定義]
- 不適切なレビューの監視は誰が行う？
- レビューの真正性検証は必要か？

[地雷の予測]
- [高リスク] 編集・削除機能の欠落 → リリース後の炎上対応コスト大
- [中リスク] 文字数制限の未定義 → DB設計のやり直し
- [低リスク] 匿名投稿の基準不明 → UI/UXの手戻り

[推奨アクション]
- 要件定義に戻る: データ定義、振る舞いの明確化
- 設計フェーズで決定: 監視の仕組み、データベーススキーマ
```

---

### UC-2: 設計書の整合性チェック

**シナリオ**: 
基本設計書を作成後、詳細設計に入る前に矛盾や抜け漏れを検証する。

**入力例**:
```
【設計】
ユーザー認証はJWT方式を採用する。
トークンの有効期限は30分とする。
リフレッシュトークンで自動延長する。
```

**期待される出力**:
```
【検出された未定義要素】

[境界条件の未定義]
- リフレッシュトークンの有効期限は？
- 同時ログインセッション数の制限は？
- トークン盗難時の無効化手段は？

[エラーハンドリングの欠落]
- トークン検証失敗時の挙動は？
- リフレッシュ失敗時のUI動作は？

[セキュリティの未定義]
- トークン保存場所（Cookie/LocalStorage）は？
- CSRF対策は？
- トークンのローテーション戦略は？

[地雷の予測]
- [高リスク] トークン保存場所の未定義 → XSS脆弱性
- [高リスク] 無効化手段の欠落 → セキュリティインシデント対応不可
- [中リスク] 同時ログイン制限なし → 不正利用のリスク

[推奨アクション]
- 設計フェーズで解決: セキュリティ要件の明確化
- 実装前に決定: エラーハンドリングの統一方針
```

---

### UC-3: API仕様書のレビュー

**シナリオ**: 
フロントエンドとバックエンドの開発を並行して進める前に、API仕様の曖昧性を解消する。

**入力例**:
```
【API仕様】
GET /api/users/:id
ユーザー情報を取得する

レスポンス:
{
  "name": "string",
  "email": "string",
  "createdAt": "date"
}
```

**期待される出力**:
```
【検出された未定義要素】

[データ定義の欠落]
- nameの最大長は？
- emailのフォーマット検証は？
- createdAtの日付フォーマットは（ISO8601？Unix timestamp？）
- nullの可能性があるフィールドは？

[エラーハンドリングの欠落]
- ユーザーが存在しない場合のステータスコードは？
- 権限がない場合のレスポンスは？
- レート制限超過時の挙動は？

[振る舞いの曖昧さ]
- 論理削除されたユーザーは取得可能か？
- 認証は必須か？
- ページネーションは必要か？

[地雷の予測]
- [高リスク] 日付フォーマット未定義 → フロント/バック間の不整合
- [中リスク] エラーレスポンスの統一性欠如 → クライアント実装の混乱
- [低リスク] null許容の不明確さ → 実行時エラー

[推奨アクション]
- 設計フェーズで統一: API設計ガイドライン（日付形式、エラー形式）
- 実装前に決定: 各フィールドの制約条件
```

---

### UC-4: テスト計画の抜け漏れ検出

**シナリオ**: 
テスト項目を作成する際に、検証すべき境界条件や異常系を網羅する。

**入力例**:
```
【機能】
パスワードリセット機能

【テスト項目】
- リセットメール送信
- 新しいパスワードの設定
```

**期待される出力**:
```
【検出された未テスト領域】

[境界条件のテスト不足]
- リセットリンクの有効期限切れ
- 既に使用されたリセットリンクの再利用
- 存在しないメールアドレスへのリクエスト
- 短時間での連続リクエスト（DoS対策）

[セキュリティテストの欠落]
- リセットトークンの推測可能性
- 他人のトークンを使用した攻撃
- メールヘッダインジェクション

[UXテストの欠落]
- メール未着時のユーザーガイダンス
- パスワードポリシー違反時のエラーメッセージ

[地雷の予測]
- [高リスク] トークン再利用の未検証 → セキュリティ脆弱性
- [中リスク] 連続リクエストの未検証 → DoS攻撃のリスク
- [低リスク] UXガイダンス不足 → サポート問い合わせ増加

[推奨アクション]
- テストフェーズで追加: セキュリティテスト項目
- 設計に戻る: DoS対策の明確化が必要
```

---

### UC-5: レガシーシステムの仕様復元

**シナリオ**: 
ドキュメントが不完全なレガシーシステムをリファクタリングする際に、暗黙的な仕様を顕在化する。

**入力例**:
```
【現状の実装から読み取った仕様】
注文処理では、在庫数をチェックして注文を確定する。
在庫が足りない場合はエラーメッセージを表示する。
```

**期待される出力**:
```
【検出された暗黙的仕様（要確認）】

[同時実行制御]
- 複数ユーザーが同時に注文した場合の在庫の整合性は？
- トランザクション分離レベルは？
- 楽観的ロック？悲観的ロック？

[ビジネスルール]
- 予約注文は可能か？
- 在庫マイナスを許容するケースは？
- 在庫切れ時の通知は必要か？

[データ整合性]
- 在庫数はリアルタイム？キャッシュ？
- 注文キャンセル時の在庫戻しは？
- 返品時の処理は？

[地雷の予測]
- [高リスク] 同時実行制御の欠如 → 在庫マイナスの発生
- [高リスク] キャンセル処理の未定義 → データ不整合
- [中リスク] キャッシュ戦略の不明 → パフォーマンス問題

[推奨アクション]
- 要件定義に戻る: ビジネスルールの確認が必須
- 設計フェーズで解決: トランザクション戦略の明確化
- テストで検証: 同時実行シナリオの網羅的テスト
```

---

## 利用タイミング

| フェーズ | 利用目的 | 期待効果 |
|---------|---------|---------|
| **要件定義** | 要件の抜け漏れ検出 | 要件凍結前に曖昧性を解消 |
| **基本設計** | アーキテクチャの前提確認 | 設計の手戻り防止 |
| **詳細設計** | インターフェース仕様の明確化 | 実装の解釈ブレ防止 |
| **実装前** | 実装方針の確認 | コーディング中の迷いを削減 |
| **テスト計画** | テスト観点の網羅性確認 | バグ検出率の向上 |
| **レビュー** | ドキュメントの品質チェック | レビュー指摘の効率化 |

---

## 効果測定指標

### 定量的指標
- 発見された未定義要素の数
- 要件定義フェーズでの手戻り削減率
- 実装フェーズでの質問・相談の減少率
- バグ発見の前倒し率（テスト前に発見された問題の割合）

### 定性的指標
- チームの仕様理解度の向上
- ステークホルダー間の認識齟齬の減少
- プロジェクトの予測可能性の向上

---

## 非ユースケース（このツールで解決できないこと）

1. **要件の正しさの判断**: ビジネス的に正しい要件かどうかは人間が判断
2. **最適な設計の提案**: 複数の設計案から最適なものを選ぶのは人間の役割
3. **完全な仕様の自動生成**: 曖昧性を指摘するだけで、答えは提供しない
4. **政治的判断**: リソース制約やビジネス優先度の判断は人間が行う


